# ARGO Troubleshooting Guide

## Common Issues and Solutions

### Porcupine Access Key Error

**Problem:** `ValueError: One or more keywords are not available by default`

**Cause:** PORCUPINE_ACCESS_KEY environment variable not set or access key invalid

**Solution:**
1. Get your access key from https://console.picovoice.ai (free account)
2. Set environment variable (choose one):
   - **Temporary (this session only):** `$env:PORCUPINE_ACCESS_KEY = "your_key_here"`
   - **Permanent (all sessions):** `setx PORCUPINE_ACCESS_KEY "your_key_here"` then restart PowerShell

3. Re-run: `python run_coordinator_v3.py`

---

### Custom Wake Word "argo" Not Recognized

**Problem:** `ValueError: One or more keywords are not available by default. Available default keywords are: picovoice, computer, hello, ...`

**Cause:** Using built-in keyword parameter instead of custom model file

**Solution:**
1. Download custom "argo" model from Picovoice console
2. Extract to `porcupine_key/` folder
3. Code already updated to use: `keyword_paths=["porcupine_key/hey-argo_en_windows_v4_0_0.ppn"]`
4. Re-run: `python run_coordinator_v3.py`

---

### Ollama Not Running

**Problem:** `ConnectionError: Failed to connect to http://localhost:11434`

**Cause:** Ollama server not started

**Solution:**
1. Start Ollama: `ollama serve`
2. Pull Qwen model: `ollama pull qwen:latest`
3. Create custom model: See [docs/coordinator_v3.md](docs/coordinator_v3.md) for Modelfile
4. Re-run coordinator

---

### Whisper Model Not Downloaded

**Problem:** `FileNotFoundError: Whisper model not found`

**Cause:** First run of Whisper needs to download base model

**Solution:**
1. Pre-download model: `python -c "import whisper; whisper.load_model('base')"`
2. This downloads ~140MB one time
3. Subsequent runs use cached model (fast)

---

### Audio Not Recording / Microphone Not Detected

**Problem:** System waits for wake word but doesn't detect any audio

**Cause:** Wrong microphone selected or microphone not working

**Solution:**
1. Test microphone: `python -c "import sounddevice; print(sounddevice.default_device)"`
2. Check system audio settings (Windows Sound panel)
3. Try different microphone (USB if available)
4. Test with: `python -c "import sounddevice as sd; print(sd.query_devices())"`

---

### No Audio Output / TTS Silent

**Problem:** System generates response but no sound

**Cause:** Edge-TTS failing or LiveKit not connected

**Solution:**
1. Check Edge-TTS: Network connectivity to Microsoft TTS API
2. Check LiveKit: Verify local server running on ports 7881-7882
3. Check audio permissions in Windows

---

### Loop Stuck / Not Exiting After 3 Interactions

**Problem:** Coordinator loops beyond max 3 interactions

**Cause:** Stop keyword not being detected in response

**Solution:**
1. Stop keywords: "stop", "goodbye", "quit", "exit"
2. Must be in response text (generated by LLM)
3. Case-insensitive
4. Fallback: Ctrl+C to interrupt

---

### All Tests Passing But Real Audio Fails

**Problem:** `test_coordinator_v3_simulated.py` passes but `run_coordinator_v3.py` fails

**Cause:** Simulated tests use mock data; real system needs actual hardware

**Solution:**
1. Verify wake word detection: Say "argo" clearly after startup
2. Verify microphone: Check Windows audio settings
3. Verify Ollama: `curl http://localhost:11434/api/models`
4. Check logs: System prints detailed error messages

---

## Debug Mode

Enable verbose logging:

```powershell
$env:DEBUG = "true"
python run_coordinator_v3.py
```

This prints:
- Porcupine initialization details
- Whisper transcription output
- Intent classification scores
- LLM prompt and response
- LiveKit publish status

---

## Performance Issues

### Latency High (>15 seconds per turn)

**Check:**
1. Ollama model size (smaller = faster)
2. Hardware: CPU speed, RAM availability
3. Whisper model: Using `base` (recommended, ~140MB)
4. Qwen model: Consider smaller variants if available

### Audio Choppy / Artifacts

**Check:**
1. Network latency to LiveKit
2. Microphone quality
3. System CPU load (background processes)
4. USB microphone (more stable than built-in)

---

## Getting Help

**Before reporting issues, verify:**
- ✅ Porcupine access key set and valid
- ✅ Custom "argo" model file downloaded
- ✅ Ollama running with Qwen model
- ✅ Microphone working in Windows
- ✅ LiveKit server accessible
- ✅ Python dependencies installed: `pip install -r requirements.txt`

**For detailed logs:**
```powershell
$env:DEBUG = "true"
python run_coordinator_v3.py 2>&1 | Tee-Object debug.log
```

This captures all output to `debug.log` for analysis.
